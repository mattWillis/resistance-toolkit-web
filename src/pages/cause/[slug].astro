---
import './_cause.scss';
import { type Org, orgs } from '../../data';
import { type Cause, causes } from '../../data';
import { Icon } from "astro-icon/components";
import Layout from '../../layouts/Layout.astro';
const { slug } = Astro.params;

export function getStaticPaths() {
  return [
    ...causes.map((cause) => ({
      params: {
        slug: cause.slug
      }
    }))
  ]
}

let allMatchedOrgs: Org[] = [];
const cause = causes.find((cause) => cause.slug === slug) as Cause;

orgs.map((org) => {
  org.cause.map((thisCause) => {
    if(thisCause === cause.slug) {
      allMatchedOrgs.push(org)
    }
  })
});

const globalOrgs: Org[] = allMatchedOrgs.filter((org) => org.scope === 'global');
const usOrgs: Org[] = allMatchedOrgs.filter((org) => org.scope === 'us');
---

<Layout 
title="Causes"
description='A list of causes that need your support.'
image=''
>
<header  class="max-w-6xl mx-auto" slot="header">
  <nav aria-label="Breadcrumb" class="flex breadcrumb">
    <ol class="flex mt-3 overflow-hidden rounded-lg border border-gray-200 text-gray-600">
      <li class="flex items-center justify-center">
        <a href="/" class="flex h-10 items-center gap-1.5 bg-gray-100 px-4 transition hover:text-gray-900">
          <svg
          xmlns="http://www.w3.org/2000/svg"
          class="size-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
          />
          </svg>
          <span class="ms-1.5 text-xs font-medium"> Home </span>
        </a>
      </li>          
      <li class="relative flex items-center">
        <span
          class="absolute inset-y-0 -start-px h-10 w-4 bg-gray-100 [clip-path:_polygon(0_0,_0%_100%,_100%_50%)] rtl:rotate-180"
        >
        </span>
        <a href="/causes" class="flex h-10 items-center bg-gray-100 pe-4 ps-8 text-xs font-medium transition hover:text-gray-900" aria-current="page">
          Causes
        </a>
      </li>
      <li class="relative flex items-center">
        <span
          class="absolute inset-y-0 -start-px h-10 w-4 bg-gray-100 [clip-path:_polygon(0_0,_0%_100%,_100%_50%)] rtl:rotate-180"
        >
        </span>
        <a href={`/cause/${cause.slug}`} class="flex h-10 items-center bg-white pe-4 ps-8 text-xs font-medium transition hover:text-gray-900" aria-current="page">
          Organizations
        </a>
      </li>
      <!-- <li><a href="/informed">Next Step</a></li> -->
    </ol>
  </nav>
</header>

<section class="max-w-3xl mx-auto py-6 lg:pt-8 px-4 pb-10">
  <h1 class="resist-select-org__title">Select an Organization</h1>
  <h2 class="resist-org__section-title">üåç Global Organizations</h2>
  <ul class="org-list">    
    {globalOrgs.map((thisOrg) => {
      return (
      <li>
        <a class="org-link" href={`/orgs/${thisOrg.slug}?cause=${cause.slug}`}>
        
          <p class="org-title">{thisOrg.name}</p>
          <p>{thisOrg.description}</p>
          {/* <p>Website: <a href={thisOrg.url} target="_blank">{thisOrg.url}</a></p> */}
        </a>
      </li>)
    })}
  </ul>
  <h2 class="resist-org__section-title">üá∫üá∏ U.S. Focused</h2>
  <ul class="org-list">
    {usOrgs.map((thisOrg) => {
      return (
      <li>        
        <a class="org-link" href={`/orgs/${thisOrg.slug}?cause=${cause.slug}`}>        
          <p class="org-title">{thisOrg.name}</p>
          <p>{thisOrg.description}</p>          
        </a>        
      </li>)
    })}
  </ul>
  {allMatchedOrgs.map((thisOrg) => {
    return (
      <div id={thisOrg.slug} class="hs-overlay hs-overlay-open:opacity-100 hs-overlay-open:duration-500 hidden size-full fixed top-0 start-0 z-[80] opacity-0 overflow-x-hidden transition-all overflow-y-auto pointer-events-none" role="dialog" tabindex="-1" aria-labelledby={`org-name-${thisOrg.name}`}>
          <div class="hs-overlay-open:mt-7 hs-overlay-open:opacity-100 hs-overlay-open:duration-500 mt-0 opacity-0 ease-out transition-all sm:max-w-lg sm:w-full m-3 sm:mx-auto min-h-[calc(100%-3.5rem)] flex items-center">
            <div class="w-full flex flex-col bg-white border shadow-sm rounded-xl pointer-events-auto dark:bg-neutral-800 dark:border-neutral-700 dark:shadow-neutral-700/70">
              <div class="flex justify-between items-center py-3 px-4 border-b dark:border-neutral-700">
                <h3 id={`org-name-${thisOrg.name}`} class="org-modal__title">
                  {thisOrg.name}
                </h3>
                <button type="button" class="size-8 inline-flex justify-center items-center gap-x-2 rounded-full border border-transparent bg-gray-100 text-gray-800 hover:bg-gray-200 focus:outline-none focus:bg-gray-200 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-700 dark:hover:bg-neutral-600 dark:text-neutral-400 dark:focus:bg-neutral-600" aria-label="Close" data-hs-overlay={`#${thisOrg.slug}`}>
                  <span class="sr-only">Close</span>
                  <svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 6 6 18"></path>
                    <path d="m6 6 12 12"></path>
                  </svg>
                </button>
              </div>
              <div class="p-4 overflow-y-auto">
                <h4 class="org-modal__section-title flex items-center">
                  <Icon name="mdi:megaphone" /> Causes
                </h4>
                <div class="org-causes">
                  {thisOrg.cause && thisOrg.cause.map((cause) => {
                    return (
                    <span class="inline-flex items-center gap-x-1.5 py-1.5 px-3 rounded-full text-xs font-medium bg-gray-500 text-white">
                        <a class="" href={`/cause/${cause}`}>{cause}</a>
                      </span>
                    )
                  })} 
                </div>
                <h4 class="org-modal__section-title flex items-center mt-4">
                  <Icon name="mdi:web-check" /> Website                  
                </h4>
                <p class="mt-1 text-gray-800 dark:text-neutral-400">
                  <a class="org-modal__web-link text-blue-600" href={thisOrg.url} target="_blank">{thisOrg.url}</a>
                </p>
                <h4 class="org-modal__section-title flex items-center mt-4">
                  <Icon name="mdi:like" /> Social Media                  
                </h4>
                <div class="social-tags">    
                  {thisOrg.social && thisOrg.social.map((social) => {
                    return (
                      <span class="inline-flex items-center gap-x-1.5 py-1.5 px-3 rounded-full text-xs font-medium bg-teal-500 text-white">
                        <a href={social.url} title={`View ${thisOrg.name} on ${social.platform}`} target="_blank">{social.platform}</a>
                      </span>        
                    )
                    })}
                </div>
              </div>
              <div class="flex justify-end items-center gap-x-2 py-3 px-4 border-t dark:border-neutral-700">
                <a href={`/actions/${thisOrg.slug}?cause=${cause.slug}`} class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 focus:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none">
                  Choose this Org
                </a>
              </div>
            </div>
          </div>
        </div>
    )
  })}
  
</section>
</Layout>