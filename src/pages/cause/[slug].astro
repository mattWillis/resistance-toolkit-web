---
import '@styles/_cause.scss';
import { type Org, orgs } from '@data/index';
import { type Cause, causes } from '@data/index';
import { Image } from 'astro:assets';
import StepImg from '@assets/Step1-New.png'
import Layout from '../../layouts/Layout.astro';
const { slug } = Astro.params;

export function getStaticPaths() {
  return [
    ...causes.map((cause) => ({
      params: {
        slug: cause.slug
      }
    }))
  ]
}

let allMatchedOrgs: Org[] = [];
const cause = causes.find((cause) => cause.slug === slug) as Cause;

orgs.map((org) => {
  org.cause.map((thisCause) => {
    if(thisCause === cause.slug) {
      allMatchedOrgs.push(org)
    }
  })
});

const sortedOrgs = allMatchedOrgs.sort((a: Org, b: Org) => {
  if (a.name < b.name) {
    return -1;
  }
  if (a.name > b.name) {
    return 1;
  }
  return 0;
});
---

<Layout 
  title={`${cause.title} - The Resistance Toolkit`}
  description={`Featured organizations - ${cause.title}. Pick an org and join the fight against the politics of hate and ignorance.`}
  image={`${Astro.site}Cause-Share.png`}
  imageAlt='Text reads Featured Cause. Next to the text is an illustration of a megaphone with sound waves coming out of it.'
>
<header class="max-w-6xl mx-auto" slot="header">
  <Image class="no-touchy" src={StepImg} alt="Pick a cause." />
</header>

<section class="max-w-3xl mx-auto py-6 lg:pt-8 px-4 pb-10">
  <h1 class="resist-select-org__title">{cause.title} - Select an Organization</h1>
  {sortedOrgs.length !== 0 && 
      <ul class="org-list">    
        {sortedOrgs.map((thisOrg) => {
          return (
          <li>
            <a rel="next" class="org-link" href={`/orgs/${thisOrg.slug}?cause=${cause.slug}`}>
              {thisOrg.ogImage ? 
                <div class="org-image__cover">
                  <Image
                    width={100}
                    height={100}
                    src={thisOrg.ogImage}
                    alt={`${thisOrg.name} social media share banner`}
                    class="org-image"
                  />
                </div> :
                <div class="org-image__cover">
                  <Image
                    width={100}
                    height={100}
                    src={'/src/assets/resist-default-img.png'}
                    alt={'Image not found'}
                    class="no-touchy org-image"
                  />
                </div>
              }  
              <p class="org-scope">
                {thisOrg.scope === 'global' ? 
                  `üåç Globally Focused` : 
                  `üá∫üá∏ U.S. Focused`
                }
              </p>
              <p class="org-title">{thisOrg.name}</p>
              <p>{thisOrg.description}</p>           
            </a>
          </li>)
        })}
      </ul>
    }
</section>
</Layout>