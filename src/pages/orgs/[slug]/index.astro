---
import './_org.scss';
import { type Org, orgs } from '../../../data';
import Layout from '../../../layouts/Layout.astro';
const { slug } = Astro.params;
import bskyQR from '@assets/qr-code.png';
import banner from '@assets/Step2-New.png';
import { Image } from 'astro:assets';

import { Icon } from "astro-icon/components";

export function getStaticPaths() {
  return [
    ...orgs.map((org) => ({
      params: {
        slug: org.slug
      }
    }))
  ]
}
const org = orgs.find((org) => org.slug === slug) as Org;
---


<Layout 
  title={org.name}
  description={org.description}
  image={''}
  >
  <header class="max-w-6xl mx-auto" slot="header">
    <img src={banner.src} alt="Stay Informed">
    <nav aria-label="Breadcrumb" class="flex breadcrumb">
      <ol class="flex mt-3 overflow-scroll rounded-lg border border-gray-200 text-gray-600">
        <li class="flex items-center justify-center">
          <a href="/" class="flex h-10 items-center gap-1.5 bg-gray-100 px-4 transition hover:text-gray-900">
            <svg
            xmlns="http://www.w3.org/2000/svg"
            class="size-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
            />
            </svg>
            <span class="ms-1.5 text-xs font-medium"> Home </span>
          </a>
        </li>          
        <li class="relative flex items-center">
          <span
            class="absolute inset-y-0 -start-px h-10 w-4 bg-gray-100 [clip-path:_polygon(0_0,_0%_100%,_100%_50%)] rtl:rotate-180"
          >
          </span>
          <a href="/causes" class="flex h-10 items-center bg-gray-100 pe-4 ps-8 text-xs font-medium transition hover:text-gray-900" aria-current="page">
            Causes
          </a>
        </li>
        <li class="relative flex items-center">
          <span
            class="absolute inset-y-0 -start-px h-10 w-4 bg-gray-100 [clip-path:_polygon(0_0,_0%_100%,_100%_50%)] rtl:rotate-180"
          >
          </span>
          <a id="org-link" href="/cause" class="flex h-10 items-center bg-gray-100 pe-4 ps-8 text-xs font-medium transition hover:text-gray-900" aria-current="page">
            Organizations
          </a>
        </li>
        <li class="relative flex items-center">
          <span
            class="absolute inset-y-0 -start-px h-10 w-4 bg-gray-100 [clip-path:_polygon(0_0,_0%_100%,_100%_50%)] rtl:rotate-180"
          >
          </span>
          <a id="action-link" href={`/actions/${org.slug}`} class="flex h-10 items-center bg-white pe-4 ps-8 text-xs font-medium transition hover:text-gray-900" aria-current="page">
            Next Step
          </a>
        </li>
        <!-- <li><a href="/informed">Next Step</a></li> -->
      </ol>
    </nav>
  </header>
  
  <section class="org-header">    
    <h1 class="org-header__title">{org.name}</h1>
    <div class="level">
      <div class="level-left">        
        {org.cause && org.cause.map((cause) => {
          return <span class="cause-tag whitespace-nowrap rounded-full px-2.5 py-0.5 text-sm"><a href={`/cause/${cause}`}>{cause}</a></span>
        })}          
      </div>    
    </div>
  </section>
  <section class="org-section org-content">
    <div class="org-info">
      <div class="org-description">
        <h2 class="flex items-center mb-4"><Icon aria-hidden="true" name="mdi:about"/> About</h2>
        <p>{org.description}</p>
        <a id="chooseOrgLink" href={`/actions/${org.slug}`} class="select-org">Choose Organization</a>
      </div>
      <div class="org-contact">
        <h2 class="flex items-center mb-4"><Icon name="mdi:web-check"/> Website</h2>
        <p>
          <a href={org.url} target="_blank">{org.url}</a>
        </p>
        <h2 class="flex items-center my-4 pb-2"> <Icon name="mdi:megaphone"/> Social Media</h2>
        <div class="social-tags">    
          {org.social && org.social.map((social) => {
            return (
            <span class="tag">
              <a href={social.url} title={`View ${org.name} on ${social.platform}`} target="_blank">{social.platform}</a>
            </span>        
          )
          })}
        </div>        
      </div>
    </div>
    <div class="my-4 bg-blue-100 border border-blue-200 text-gray-800 rounded-lg p-4" role="note" tabindex="-1" aria-labelledby="note-title">
      <div class="flex gap-4">
        <div class="flex sm:w-1/3 lg:w-1/2 sm:w-1">
          <div class="shrink-0">
            <svg class="shrink-0 size-4 mt-1" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M12 16v-4"></path>
              <path d="M12 8h.01"></path>
            </svg>
          </div>
          <div class="ms-3">
            <h3 id="note-title" class="font-semibold">
              A note about Social Media
            </h3>
            <div class="mt-2 text-sm text-gray-800">
              I encourage you to use social media platforms that are open sourced and decentralized (like <a href="https://bsky.app/" class="text-blue-800 font-bold" target="_blank">BlueSky</a> or <a href="https://joinmastodon.org/" class="text-blue-800 font-bold" target="_blank">Mastodon</a>). However, your organization might not have an account on these newer platforms, so go where your orgs are.     
            </div>
          </div>          
        </div>
        <div>
          <p class="text-sm">This is a link to a <a href="https://go.bsky.app/8i9FuqR" class="text-blue-800 font-bold" target="_blank">starter pack of organizations</a> that are currently on BlueSky.</p>
          <div class="qr-wrapper">
            <Image src={bskyQR} height={80} width={80} alt="QR code to the Resistance Toolkit Starter Pack on BlueSky Social. Scan with your phone's camera to open up the link." />
          </div>
        </div>
      </div>
    </div>

    <!-- I am providing links to BlueSky because it's algorithms are open source and transparent. Don't like your feed? You can create your own or find a feed created by a fellow user. -->
  </section>
</Layout>

<script>
  document.addEventListener('astro:page-load', () => {
    let cause: string | null;
    cause = null;
    
    const urlSearchParams = new URLSearchParams(window.location.search);
    if(urlSearchParams.has('cause')) {
      cause = urlSearchParams.get('cause');
    }
    const orgLink = document.getElementById('org-link');
    const actionLink = document.getElementById('action-link');
    const chooseOrgLink = document.getElementById('chooseOrgLink');
    if(cause !== null && orgLink !== null) {
      orgLink.setAttribute('href', `/cause/${cause}`);
    }
    if(cause !== null && actionLink !== null && chooseOrgLink !== null) {
      const oldHref = actionLink.getAttribute('href');
      const newHref = oldHref + `?cause=${cause}`;
      actionLink.setAttribute('href', newHref);
      chooseOrgLink.setAttribute('href', newHref);
    }
  
    // console.log('Current cause: ', cause);
  })

  </script>